define(function(require,exports,module){var i={config:{},init:function(){i.bindEvents()},bindEvents:function(){$(".js-login").on("click",i.login),$(".js-bind").on("click",i.bind),$(".js-vcode, .js-bindVcode").on("click",i.getVCode)},getVCode:function(){function i(e){0==o?e.removeClass("ban").text(c):(e.text(o+"秒后可重发"),o--,setTimeout(function(){i(e)},1e3))}var e=$(".fm-login"),t=e.find(".js-mobile"),n=$.trim(t.val()),s=/^1[3,5,7,8]{1}\d{9}$/;if(!n||!s.test(n))return M.tips("请输入正确的手机号！"),!1;var a=$(this);if(a.hasClass("ban"))return!1;a.addClass("ban");var o=60,c=a.text();i(a);var r=a.is(".js-vcode")?"/api/sendMessage":"/api/sendBindMessage";M.ajax({url:r,data:{mobile:n},success:function(i){i.success_code?M.tips("发送成功"):M.tips(i.error)}})},login:function(){var e=$(".fm-login");return!!i.validate(e)&&void M.ajax({url:"/api/login",data:e.serialize(),success:function(i){i.success&&M.tips({body:"登录成功！",callback:function(){location.href=M.url.query("origin")||location.origin}})}})},bind:function(){var e=$(".fm-login");return!!i.validate(e)&&void M.ajax({url:"/api/bind",data:e.serialize(),success:function(i){i.success&&M.tips({body:"绑定成功！",callback:function(){location.href=M.url.query("origin")||location.origin}})}})},validate:function(i){var e=!0,t=$(i).find(':text,:password,[type="tel"],[type="email"],[type="number"],[type="date"],[type="search"],[type="time"],[type="url"]');return $.each(t,function(){var i=$(this),t=$.trim(i.val()),n=i.data("type"),s=i.closest("li").find("em").text().replace(/\s|\*|:|：/g,"");if(""===t)return M.tips(s+"不能为空！"),e=!1;switch(n){case"mobile":if(!/^1[3,4,5,7,8]{1}\d{9}$/.test(t))return M.tips("请输入正确的"+s),e=!1;break;case"integer":if(!/^\d{6}$/.test(t))return M.tips("请输入正确的"+s),e=!1}}),e}};i.init()});