define(function(require,exports,module){var e={config:{api:{index:"/api/storeList",detail:"/api/storeDetail",myServerStore:"/api/myServerStore",myShowStore:"/api/myShowStore",myAddress:"/api/myAddress",addCollect:"/api/addCollect",delCollect:"/api/delCollect",delServiceShop:"/api/delServiceShop"}},info:{},init:function(){var t=this;t.info;require.async("router",e.setRouter),e.bindEvents()},bindEvents:function(){var e=this;e.info},setRouter:function(){var t=new Router({container:"#app",enter:"enter",leave:"leave",enterTimeout:250,leaveTimeout:250}),a={url:"/",render:function(t){var a=M.url.params(),o={},i=JSON.parse(localStorage.getItem(CONST.local_storeAddr))||{};i.deliveryAddrId&&$.extend(o,i,{formattedAddress:i.gpsAddr+i.addrDetail}),a.shopType&&Number(a.shopType)&&(o.shopType=Number(a.shopType)),console.log(o),t.loadingDelay=10,e.renderModule("index",t,o)},bind:function(){var t=$(this),a=e.info;e.config;e.setService(t),a.popAddress=$(".m-select-address"),$(".js-change-address").on("click",function(){a.popAddress.addClass("show"),e.getAddress()}),a.popAddress.on("click",".js-close",function(){a.popAddress.removeClass("show")}),a.popAddress.on("click",".js-gps-address",function(){localStorage.removeItem(CONST.local_storeAddr),M.reload()}),$.pagination({keys:{count:"count"},scrollBox:".m-stores",api:e.config.api.index,fnSuccess:function(e,t){var a=e.data;return a.template?void t.append(a.template):t.data("locked",!0).after('<div class="u-null-page"><em>该区域无更多门店</em></div>')}}),$(".u-stores.attention .js-collect").on("click",function(){var t=$(this),a=JSON.stringify({collectIds:t.data("collectid")});e.delCollect({api:e.config.api.delCollect,data:a,shopId:t.data("id"),callback:function(){M.reload()}})}),$(".u-stores.service .js-collect").on("click",function(){var t=$(this),a=JSON.stringify({msId:t.data("collectid")});e.delCollect({api:e.config.api.delServiceShop,data:a,shopId:t.data("id"),callback:function(){M.reload()}})})}},o={url:"/detail/:shopId/",render:function(t){var a=this.params,i=JSON.parse(localStorage.getItem(CONST.local_storeAddr))||{};i.deliveryAddrId&&$.extend(a,i,{formattedAddress:i.gpsAddr+i.addrDetail}),o.params=a,e.renderModule("detail",t,a)},bind:function(){var t=$(this),a=e.info;a.collect=$(".js-collect"),a.collect.on("click",".u-btn",function(){var t=$(this),a={collectid:t.parent().data("collectid"),collectItemId:t.parent().data("id"),collectType:3};t.hasClass("active")?a.status=1:a.status=0,e.setCollect(a)}),a.location=$(".js-open-location"),a.location.on("click",function(){e.openLocation()}),e.setService(t);var i=$(".js-store-basic");i.on("click",".js-more",function(){var e=$(this);i.hasClass("up")?(i.removeClass("up"),e.find("span").text("收起")):(i.addClass("up"),e.find("span").text("更多"))});var s=$(".js-goods-tab li");s.on("click",function(){var t=$(this);t.hasClass("active")||(s.removeClass("active"),t.addClass("active"),e.cutoverGoodsList({ajax:!0,tabId:t.data("id"),showTab:0,pageSize:10,page:1,shopId:o.params.shopId}),console.log($(this).data("id")))}),M.nav.init({scrollArea:t}),M.lazyLoad.init({container:".node-stores-detail-goods"}),require.async("weixin",function(e){M.wx.share(e,{title:$(".js-share-title").text(),url:location.href,image:$(".js-share-image").data("share"),desc:$(".js-share-desc").text()})}),$(".pagination").data("params",{showTab:0,pageSize:10,tabId:-1,shopId:o.params.shopId}),$.pagination({keys:{index:"nextPageStart"},scrollBox:".spa",api:e.config.api.detail,fnSuccess:function(e,t){var a=e.data;return a.template?(t.append(a.template),void M.lazyLoad.init({container:t})):t.data("locked",!0)},fnLoading:function(e){e.after('<div class="tc pagination-loading">正在加载中...</div>')}})}},i={url:"/list/server",render:function(t){var a=this.params;e.renderModule("myServerStore",t,a)},bind:function(){var t=$(this);e.info;e.setService(t),$(".js-collect").on("click",function(){var t=$(this),a=JSON.stringify($.extend({},{msId:t.data("collectid")}));e.delCollect({api:e.config.api.delServiceShop,data:a,shopId:t.data("id")})})}},s={url:"/list/show",render:function(t){var a=this.params;e.renderModule("myShowStore",t,a)},bind:function(){var t=$(this);e.info;e.setService(t),$(".js-collect").on("click",function(){var t=$(this),a=JSON.stringify($.extend({},{collectIds:t.data("collectid")}));e.delCollect({api:e.config.api.delCollect,data:a,shopId:t.data("id")})})}};t.push(a).push(o).push(i).push(s).setDefault("/").init()},renderModule:function(module,t,a){var o=require("app/renderSPA");o(e.config.api[module],t,a)},setService:function(module){var t=module,a=e.info;$(".u-stores").on("click",".list a",function(e){e.preventDefault();var t=$(e.target),a=$(this);t.parents(".js-service").length||(window.location.hash=a.attr("href"))}),a.popService=$(".u-stores-service"),t.on("click",".js-service li",function(){e.showService($(this).parents(".js-service").data("json"))}),a.popService.on("click",".js-close,.mask",function(){a.popService.removeClass("show")})},showService:function(e){var t=this,a=t.info,o=e.length,i=[];if(o){for(var s=0;s<o;s++)i.push('<li><div class="icon"><img src="'+e[s].tagPic+'@40w_40h_100q.jpg" alt=""></div><dl><dt>'+e[s].tagTitle+"</dt><dd>"+e[s].tagDesc+"</dd></dl></li>");a.popService.addClass("show").find(".list").html(i.join(""))}},getAddress:function(t){var a=this,o=a.info,i=JSON.stringify($.extend({},t));o.popAddress.find(".list li").length||M.ajax({url:e.config.api.myAddress,data:{data:i},success:function(e){if(e.template){o.popAddress.find(".list").html(e.template);var t=JSON.parse(localStorage.getItem(CONST.local_storeAddr))||{};t.deliveryAddrId&&$("#add-"+t.deliveryAddrId).attr("checked","checked"),a.setAddress()}},error:function(e){}})},setAddress:function(){var e=this,t=e.info;t.popAddress.on("change",".u-checkbox",function(){var e=$(this).parents("li");localStorage.setItem(CONST.local_storeAddr,JSON.stringify(e.data("json"))),M.reload()})},cutoverGoodsList:function(t){var a=JSON.stringify($.extend({},t)),o=$(".pagination");o.data("params",t).data("locked",!1),M.ajax({url:e.config.api.detail,data:{data:a},success:function(e){e.template&&o.html(e.template),M.lazyLoad.init({container:".node-stores-detail-goods"}),console.log(e)}})},setCollect:function(t){var a=e.info,o=$(".js-collect-count");if(t.status){var i=JSON.stringify($.extend({},{collectIds:t.collectid}));M.ajax({url:e.config.api.delCollect,data:{data:i},success:function(e){a.collect.find(".u-btn").removeClass("active").addClass("success").html("+ 关注"),o.text(Number(o.text())-1),M.tips("取消关注成功")}})}else{var i=JSON.stringify($.extend({},{collectType:t.collectType,collectItemId:t.collectItemId}));M.ajax({url:e.config.api.addCollect,data:{data:i},success:function(e){a.collect.data("collectid",e.data.collectId).find(".u-btn").removeClass("success").addClass("active").html("已关注"),o.text(Number(o.text())+1),M.tips({class:"true",body:"关注成功",delay:2e3})}})}},delCollect:function(e){M.dialog({body:"确定要删除这个门店吗?",buttons:[{text:"取消"},{text:"确定",class:"success",onClick:function(){var t=this;M.ajax({url:e.api,data:{data:e.data},success:function(){$(".js-shop-"+e.shopId).remove(),M.tips({body:"取消关注成功",callback:function(){e.callback&&e.callback.call(this)}}),t.hide()}})}}]})},openLocation:function(){var t=e.info,a=t.location.data("basic");require.async("weixin",function(e){M.wx.init(e,{ready:function(){e.openLocation({latitude:Number(a.lat),longitude:Number(a.lng),name:a.shopName,address:a.shopAddr,scale:14,infoUrl:""})}})})}};e.init()});