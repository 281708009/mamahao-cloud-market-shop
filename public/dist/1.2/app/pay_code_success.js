define(function(require,exports,module){var o={tools:{isMobile:function(o){return!!/^1{1,}[3,4,5,7,8]{1}\d{9}$/.test(o)}},config:{api:{}},info:{},init:function(){var i=this,n=i.info,e=i.config;VM&&$.extend(e,VM),n.mobile=$(".js-mobile"),n.code=$(".js-code"),n.getCode=$(".js-get-code"),n.submit=$(".js-submit"),n.pop=$(".m-pop-all"),o.bindEvents(),o.getCoupon()},bindEvents:function(){var o=this,i=o.info,n=o.config;$(".js-close-app").on("click",function(){$(".MA-download-pop-all").removeClass("show")}),n.isWeChat&&require.async("weixin",function(o){o.hideOptionMenu()}),i.submit.on("click",function(){o.getSubmit()}),i.getCode.on("click",function(){o.getSMS()}),i.pop.on("click",".title .close",function(){i.pop.removeClass("show"),i.mobile.val(""),i.code.val("")})},getCoupon:function(){var o=this;o.info,o.config;M.ajax({url:"/pay/codeCouponInfo.html",success:function(o){$(".m-code-success").addClass("show")},error:function(){}})},getSMS:function(){var o=this,i=o.info,n=o.config;if(!n.isAjax&&!n.isSecond){if(!o.tools.isMobile(i.mobile.val()))return M.tips("请输入正确的手机号码");var e=JSON.stringify({mobile:i.mobile.val()});n.isAjax=!0,M.ajax({url:"/pay/codeSMS.html",data:{data:e},success:function(o){i.mobile.attr("disabled","disabled"),n.isSecond=!0,i.getCode.html("<i></i>秒后可重发").addClass("ban").find("i").secondCountDown({second:59,endcall:function(){n.isSecond=!1,i.getCode.removeClass("ban").html("获取验证码"),i.mobile.removeAttr("disabled")}})},complete:function(){n.isAjax=!1}})}},getSubmit:function(){var o=this,i=o.info,n=o.config;if(!n.isAjax){if(!o.tools.isMobile(i.mobile.val()))return M.tips("请输入正确的手机号码");if(!$.trim(i.code.val()))return M.tips("请输入短信验证码");var e=JSON.stringify({mobile:i.mobile.val(),vcode:i.code.val()});M.ajax({url:"/pay/codeCoupon.html",data:{data:e},success:function(o){i.pop.addClass("show")},error:function(o){i.code.val(""),M.tips({body:o.msg,delay:2e3})},complete:function(){n.isAjax=!1}})}}};o.init()});