define(function(require,exports,module){var t={config:{params:M.url.params(),hashParams:function(){return M.url.getParams((location.hash.match(/(\w+=)([^\&]*)/gi)||[]).join("&"))}},init:function(a){t.bindEvents()},bindEvents:function(){var a=$("#app");a.on("click",".js-sku",t.selectSku),a.on("change",".item :radio",function(){var t=$(this).closest(".item");$(this).is(":checked")&&t.addClass("selected").siblings().removeClass("selected")}),a.on("click",".js-addToCart",t.addToCart),a.on("click",".mask, .js-close",function(){$(this).closest(".u-fixed").removeClass("show")}),a.on("click",".js-sku-confirm",function(){var t=$(this),a=$(".js-sku.current").closest(".item");require.async("app/sku",function(e){var s=e.selected();if(!s.itemId){var i=$.map($(".sku dl dt"),function(t){if(!$(t).closest("dl").find(".sku-key.active")[0])return $(t).text()})[0];return M.tips("请选择"+i)}a.attr("data-item-id",s.itemId).find(".sku-edit").addClass("selected").text("已选"+s.desc.join(",")),t.closest(".u-sku").find(".js-close").trigger("click")})})},selectSku:function(){var a=t.config,e=$(this),s=e.data("template-id"),i=a.params.reservedNo;if($(".js-sku").removeClass("current"),e.addClass("current"),s===$(".js-sku-confirm").data("template-id"))return $(".u-sku").addClass("show"),!1;var n={inlet:6,reservedNo:i,templateId:s},c=JSON.parse(localStorage.getItem(CONST.local_detail_location));c&&(n.areaId=c.areaId,n.lat=c.lat,n.lng=c.lng),M.ajax({location:!0,url:"/api/goods_sku",data:{data:JSON.stringify(n)},success:function(t){$(".u-sku").find(".content").empty().append(t.template).find(".quantity").remove().end().end().addClass("show"),require.async("app/sku",function(t){t.init($(".sku")),$(".js-sku-confirm").data("template-id",s)})}})},addToCart:function(){for(var a=t.config,e=localStorage.getItem(CONST.local_cartId),s=$(".item.selected"),i=0;i<s.length;i++){var n=$(s[i]);if(!n.attr("data-item-id"))return n.is(".main-product")?M.tips("请选择主商品的商品规格"):M.tips("请选择赠品的商品规格"),!1}var c=$.map(s,function(t,a){return{isBindShop:!1,templateId:$(t).data("template-id"),itemId:$(t).data("item-id"),count:1,isGift:!$(t).is(".main-product")}}),r={cartId:e,jsonTerm:JSON.stringify(c),pmtType:6,reservedNo:a.params.reservedNo};M.ajax({location:!0,url:"/api/addToCart",data:{data:JSON.stringify(r)},success:function(t){return 200!=t.success_code?M.tips(t.msg):(localStorage.setItem(CONST.local_cartId,t.cartId),M.tips("商品已成功添加到购物车"),$(".u-sku .js-close").trigger("click"),void 0)}})}};t.init()});