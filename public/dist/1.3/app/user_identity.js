define(function(require,exports,module){var e={config:{params:M.url.params(),hashParams:function(){return M.url.getParams((location.hash.match(/(\w+=)([^\&]*)/gi)||[]).join("&"))},api:{breed_add:"/api/breed_add",breed_update:"/api/breed_update",breed_delete:"/api/breed_delete",update_profile_cache:"/api/update_profile_cache"}},init:function(){e.bindEvents()},bindEvents:function(){var a=(e.config,$("#app"));a.on("click",".type li",function(){var a=$(this),t=a.index();if(a.hasClass("active"))return!1;if(a.addClass("active").siblings().removeClass("active"),a.find(":radio").prop("checked",!0),$(".type li").data("picker",null),0===t){var i=$(".picker-modal.modal-in");i&&i.trigger("close"),e.breedSave()}}),require.async("picker",function(){var t={container:a,affix:!0,format:"yyyy-MM-dd",level:3,atOnce:!1,toolbarCloseText:""},i={toolbarTitle:"请选择预产期",ifClose:function(e){var a=+new Date((new Date).format("yyyy/MM/dd")),t=+new Date(e.value[0],e.value[1]-1,e.value[2]),i=a+24192e6;return!(t<a||t>i)||(M.tips("请选择合理的预产期"),!1)},onConfirm:function(a){e.breedSave(a)}},n={toolbarTitle:"请选择宝宝生日",ifClose:function(e){var a=new Date,t=+new Date(a.format("yyyy/MM/dd")),i=+new Date(e.value[0],e.value[1]-1,e.value[2]),n=+new Date(a.getFullYear()-14,a.getMonth(),a.getDay());return!(i>t||i<n)||(M.tips("请选择正确的宝宝生日"),!1)},onConfirm:function(a){e.breedSave(a)}};$(".li-1").datetimePicker($.extend({},t,i)),$(".li-2,.li-3").datetimePicker($.extend({},t,n))})},breedSave:function(a){var t=e.config,i=(t.hashParams(),$(".u-checkbox:checked")),n={status:i.data("status")};switch(n.status){case 1:n.duaDate=a.string;break;case 2:n.baby={babyName:"",babyGender:i.data("gender"),babyBirthday:a.string};break;case 3:}n={json:JSON.stringify(n)},M.ajax({url:t.api.breed_add,data:{data:JSON.stringify(n)},success:function(){var a=t.params.origin||"/center#/";e.updateProfileCache(function(){location.href=a})}})},updateProfileCache:function(a){var t=e.config;t.hashParams();M.ajax({url:t.api.update_profile_cache,success:function(){a&&a(),console.info("update profile cache succeed!")}})}};e.init()});