define(function(require,exports,module){var e={config:{params:M.url.params(),hashParams:function(){return M.url.getParams((location.hash.match(/(\w+=)([^\&]*)/gi)||[]).join("&"))},api:{home:"/api/center",profile:"/api/profile",profileEdit:"/api/profile_edit",orders:"/api/orders",orderDetail:"/api/order_detail",orderResult:"/api/order_result",address:"/api/address",addressEdit:"/api/address_edit",addressGPS:"/api/address_gps",addressSearch:"/api/address_search",addressSave:"/api/address/save",addressDelete:"/api/address/delete",queryArea:"/api/address/queryArea",beans:"/api/beans",coupons:"/api/coupons",couponsExchange:"/api/coupons_exchange",integral:"/api/integral",orderExpress:"/api/order_express",orderReview:"/api/order_review",orderReviewSubmit:"/api/order/reviewSubmit",orderReviewDetail:"/api/order_review_detail",orderRebuy:"/api/order_rebuy",orderReviewResult:"/result/review",orderCart:"/api/order_cart",orderSettlement:"/api/order_cart"}},init:function(){require.async("router",e.setRouter),e.bindEvents()},bindEvents:function(){},setRouter:function(){var a=(e.config,new Router({container:"#app",enter:"enter",leave:"leave",enterTimeout:250,leaveTimeout:250})),t={url:"/index/:params?",render:function(a){t.hashParams=M.url.getParams(this.params.params),e.renderModule("home",a,t.hashParams)},bind:function(){}},r={url:"/profile",render:function(a){e.renderModule("profile",a)},bind:function(){require.async("app/profile",function(e){e.init()})}},i={url:"/profileEdit/:params?",render:function(a){p.hashParams=M.url.getParams(this.params.params),e.renderModule("profileEdit",a,p.hashParams)},bind:function(){require.async("app/profile",function(e){e.init()})}},s={url:"/orders",className:"m-order",render:function(a){e.renderModule("orders",a)},bind:function(){var a=$(this);require.async("app/order",function(t){new t(e,a).render()})}},n={url:"/order/detail/:orderNo/:queryType?",render:function(a){this.params.queryType&&(this.params.queryType=+this.params.queryType);var t=this.params;e.renderModule("orderDetail",a,t)},bind:function(){var a=$(this);require.async("app/order",function(t){new t(e,a).render()})}},d={url:"/order/rebuy/:orderNo/:queryType?",render:function(a){this.params.queryType&&(this.params.queryType=+this.params.queryType);var t=this.params;e.renderModule("orderRebuy",a,t)},bind:function(){var a=$(this);require.async("app/order",function(t){new t(e,a).render()})}},o={url:"/order/express/:orderNo",className:"m-courier",render:function(a){var t=this.params;e.renderModule("orderExpress",a,t)},bind:function(){var e=$(this);!e.children().is(".no-invoice-logistics")&&M.swipe.init(),e.on("click",".more-show",function(){var e=$(this).prev();e.toggleClass("in"),$(this).find("em").html(e.is(".in")?"隐藏商品":"显示其余"+$(this).data("num")+"件")})}},c={url:"/order/review/:orderNo",render:function(a){var t=this.params;e.renderModule("orderReview",a,t)},bind:function(){var a=$(this);a.on("click",".js-review-submit",function(){var t=$(this).data("params");if(t.serveStar=+$("#serveStar").data("star"),t.deliverySpeedStar=+$("#deliverySpeedStar").data("star"),0==t.serveStar)return alert("服务态度评价不能为空");if(0==t.deliverySpeedStar)return alert("配送速度评价不能为空");var r=[];a.find(".js-item").each(function(e,a){var t=$(this),i=[],s=t.data();return s.star=+t.find(".star").data("star"),s.content=t.find(".js-review-ctn").val(),""===s.content?(alert("商品评价内容为空"),!1):s.content.length>140?(alert("字数超出最大限制"),!1):(t.find(".file li .item").each(function(){i.push($(this).find("img").data("filename"))}),i.length&&(s.pics=i.toString()),void r.push(s))}),0!==r.length&&(t.jsonArrays=JSON.stringify(r),M.ajax({url:e.config.api.orderReviewSubmit,data:{data:JSON.stringify(t)},success:function(e){e.success&&(location.href="/center#/order/result/orderNo="+t.orderNo+"&mbeanGet="+e.mbeanGet)}}))}),a.on("click",".js-star li",function(){var e=$(this).text();$(this).closest("ol").prev().attr("class","star star-"+e).data("star",e)}),$(".js-oss-file").on("change",function(e){var a=e.target.files[0];console.log(a),$file=$(this);var t=new FormData;t.append("file",a),M.ajax({type:"post",url:"/oss/uploadImage",cache:!1,data:t,processData:!1,contentType:!1,success:function(e){e.success&&($file.closest("li").before('<li><div class="item"><img src="'+e.url+'" alt="" data-filename="'+e.name+'"><del></del></div></li>'),$file.val(""),$(".file li .item").length>=5&&$file.closest("li").hide())}})}),a.on("click","del",function(){$(this).closest("li").remove(),$(".file li.item").length<5&&$file.closest("li").show()})}},l={url:"/order/reviewDetail/:orderNo/:itemId?/:mbeans?",render:function(a){var t=this.params;e.renderModule("orderReviewDetail",a,t)},bind:function(){var a=$(this);a.on("click",".js-review-submit",function(){var a=$(this).data("params");if(a.content=$("#reviewCtn").val(),$("#deliverySpeedStar").length&&(a.deliverySpeedStar=+$("#deliverySpeedStar").data("star")),$("#serveStar").length&&(a.serveStar=+$("#serveStar").data("star")),$("#goodsStar").length&&(a.star=+$("#goodsStar").data("star")),""===a.content)return alert("商品评价内容为空");if(a.content.length>140)return alert("字数超出最大限制");var t=[];$(".file li .item").each(function(){t.push($(this).find("img").data("filename"))}),t.length&&(a.pics=t.toString()),M.ajax({url:e.config.api.orderReviewSubmit,data:{data:JSON.stringify(a)},success:function(e){e.success&&(location.href="/center#/order/result/orderNo="+a.orderNo+"&mbeanGet"+e.mbeanGet)}})}),a.on("click",".js-star li",function(){var e=$(this).text();$(this).closest("ol").prev().attr("class","star star-"+e).data("star",e)}),$(".js-oss-file").on("change",function(e){var a=e.target.files[0];console.log(a),$file=$(this);var t=new FormData;t.append("file",a),M.ajax({type:"post",url:"/oss/uploadImage",cache:!1,data:t,processData:!1,contentType:!1,success:function(e){console.log("res---->",JSON.stringify(e)),e.success&&($file.closest("li").before('<li><div class="item"><img src="'+e.url+'" alt="" data-filename="'+e.name+'"><del></del></div></li>'),$file.val(""),$(".file li .item").length>=5&&$file.closest("li").hide())}})}),a.on("click","del",function(){$(this).closest("li").remove(),$(".file li.item").length<5&&$file.closest("li").show()})}},u={url:"/order/result/:params",render:function(a){var t=this.params;t=M.url.getParams(t.params),e.renderModule("orderResult",a,t)},bind:function(){M.lazyLoad.init();var a=$(this);a.on("click",".js-review-submit",function(){var t={orderNo:$('[name="orderNo"]').val()};if(t.serveStar=+$("#serveStar").data("star"),t.deliverySpeedStar=+$("#deliverySpeedStar").data("star"),0==t.serveStar)return alert("服务态度评价不能为空");if(0==t.deliverySpeedStar)return alert("配送速度评价不能为空");var r=[];a.find(".js-item").each(function(e,a){var t=$(this),i=[],s=t.data();return s.star=+t.find(".star").data("star"),s.content=t.find(".js-review-ctn").val(),""===s.content?(alert("商品评价内容为空"),!1):s.content.length>140?(alert("字数超出最大限制"),!1):(t.find(".file li .item").each(function(){i.push($(this).find("img").data("filename"))}),i.length&&(s.pics=i.toString()),void r.push(s))}),0!==r.length&&(t.jsonArrays=JSON.stringify(r),M.ajax({url:e.config.api.orderReviewSubmit,data:{data:JSON.stringify(t)},success:function(e){e.success&&(location.href="/center#/order/result/orderNo="+t.orderNo+"&mbeanGet="+e.mbeanGet)}}))}),a.on("click",".js-star li",function(){var e=$(this).text();$(this).closest("ol").prev().attr("class","star star-"+e).data("star",e)}),$(".js-oss-file").on("change",function(e){var a=e.target.files[0];console.log(a),$file=$(this);var t=new FormData;t.append("file",a),M.ajax({type:"post",url:"/oss/uploadImage",cache:!1,data:t,processData:!1,contentType:!1,success:function(e){console.log("res---->",JSON.stringify(e)),e.success&&($file.closest("li").before('<li><div class="item"><img src="'+e.url+'" alt="" data-filename="'+e.name+'"><del></del></div></li>'),$file.val(""),$(".file li .item").length>=5&&$file.closest("li").hide())}})}),a.on("click","del",function(){$(this).closest("li").remove(),$(".file li.item").length<5&&$file.closest("li").show()})}},p={url:"/address/:params?",className:"m-address",render:function(a){p.hashParams=M.url.getParams(this.params.params),e.renderModule("address",a,p.hashParams)},bind:function(){var e=$("#app"),a=$(this);e.data("data",null),p.hashParams.f&&a.on("click",".detail",function(){var e=$(this).data("info"),a={deliveryAddrId:e.deliveryAddrId,addr:[e.prv,e.city,e.area,e.gpsAddr,e.addrDetail].join(""),consignee:e.consignee,phone:e.phone,areaId:e.areaId,isDefult:e.isDefault};localStorage.setItem(CONST.local_settlement_addr,JSON.stringify(a)),window.history.go(-1)})}},f={url:"/addressAdd/:params?",className:"m-address-edit",render:function(){return f.hashParams=M.url.getParams(this.params.params),$("#tpl_address_add").html()},bind:function(){var a=$(this);a.data("hash-params",f.hashParams),e.updateAddressData(a),e.bindAddressEvents(a)}},h={url:"/addressEdit/:id/:params?",className:"m-address-edit",render:function(a){h.hashParams=M.url.getParams(this.params.params);var t=$.extend({},{id:+this.params.id},h.hashParams);e.renderModule("addressEdit",a,t)},bind:function(){var a=$(this);a.data("hash-params",h.hashParams),e.updateAddressData(a),e.bindAddressEvents(a)}},m={url:"/addressSearch/:areaId/:province?",className:"m-address-search",render:function(){return this.params.areaId=+this.params.areaId,m.params=this.params,$("#tpl_address_search").html()},bind:function(){var e=m.params;require.async("app/address_search",function(a){new a(e).render()})}},v={url:"/addressGps",className:"m-address-search",render:function(a){require.async("app/address_gps",function(t){new t(e,a).render()})},bind:function(){var e=$(this);e.on("click",".list li",function(){var e=$(this),a=$("#app"),t=e.data("info");AMap.service("AMap.Geocoder",function(){var r=new AMap.Geocoder,i=[t.location.lng,t.location.lat];r.getAddress(i,function(r,i){if("complete"===r&&"OK"===i.info){var s=i.regeocode,n=s.addressComponent;console.log(n),n.province=n.province.replace(/省$/,"");var d=a.data("data")||{};d.gpsAddr=e.find("dt span").text(),d.district=[n.province,n.city,n.district].join(""),d.areaId=n.adcode,d.prv=n.province,d.city=n.city,d.area=n.district,d.lat=t.location.lat,d.lng=t.location.lng,a.data("data",d),window.history.go(-1)}})})})}},g={url:"/beans",className:"m-beans",render:function(a){e.renderModule("beans",a)},bind:function(){var a=$(".m-record .list");a.children()[0]||a.data("locked",!0),$.pagination({container:".m-record .list",api:e.config.api.beans,fnSuccess:function(e,a){var t=e.data;return t.template?void a.append(t.template):a.data("locked",!0)}})}},y={url:"/integral/:type?",className:"m-integral",render:function(a){this.params.type=+this.params.type,y.params=this.params,e.renderModule("integral",a)},bind:function(){M.swipe.init();var a=$(".ui-swipe-item .list");$.each(a,function(){$(this).children()[0]||$(this).data("locked",!0)}),$.pagination({keys:{page:"pageNo"},container:".ui-swipe-item .list",api:e.config.api.integral,fnSuccess:function(e,a){var t=e.data;return t.template?void a.append(t.template):a.data("locked",!0)}})}},S={url:"/coupons",className:"m-coupon",render:function(a){e.renderModule("coupons",a)},bind:function(){M.swipe.init();var a=$(".ui-swipe-item .list");$.each(a,function(){$(this).children()[0]||$(this).data("locked",!0)}),$.pagination({container:".ui-swipe-item .list",api:e.config.api.coupons,fnSuccess:function(e,a){var t=e.data;return t.template?void a.append(t.template):a.data("locked",!0)}});var t=$(this);t.on("click",".js-exchange",function(){var a=$(this),t=a.siblings(".coupon-code").val(),r={cdKey:t};M.ajax({url:e.config.api.couponsExchange,data:{data:JSON.stringify(r)},success:function(e){e.success&&M.tips({body:"优惠券兑换成功！",callback:function(){M.reload()}})}})})}},b={url:"/order/cart/:orderNo",render:function(a){this.params.queryType&&(this.params.queryType=+this.params.queryType);var t=this.params;e.renderModule("orderCart",a,t)},bind:function(){var e=$(this);if(e.find("#errorAlert").length)return void M.dialog({body:$("#errorAlert").data("tips"),buttons:[{text:"我知道了",class:"alone",onClick:function(){this.hide(),history.length?history.go(-1):location.href="/center#/orders"}}]});var a=$('[name="cartId"]').val(),t=$('[name="orderNo"]').val();e.on("click",".js-select-all",function(r){if(!$(this).closest(".edit").length){var i=$(this).find(".u-checkbox:visible").is(":checked")?2:3,s={cartId:a,orderNo:t,isSelected:i};M.ajax({location:!0,url:"/api/order_cart/opt/selectedCartWithInspect",data:{data:JSON.stringify(s)},success:function(a){e.html(a.template)}})}}),e.on("click",".js-checkbox",function(){var r=$(this).closest(".js-item"),i=$(this).find(".u-checkbox:visible").is(":checked")?0:1,s={cartId:a,orderNo:t,isSelected:i,compoentId:"undefined"!=typeof $(this).closest("li").data("compoentId")?$(this).closest("li").data("compoentId"):r.data("compoentId")};M.ajax({location:!0,url:"/api/order_cart/opt/selectedCartWithInspect",data:{data:JSON.stringify(s)},success:function(a){e.html(a.template)}})}),e.on("click",".js-update",function(){var r=$(this),i=r.closest(".js-item"),s=+r.data("count"),n=+r.data("max");if(s<=0||$(this).is(".disabled")||s>=n){if($(this).data("tips"))return alert($(this).data("tips"))}else{var d={cartId:a,orderNo:t,newCount:s,compoentId:"undefined"!=typeof $(this).closest("li").data("compoentId")?$(this).closest("li").data("compoentId"):i.data("compoentId")};M.ajax({location:!0,url:"/api/order_cart/opt/updateCartItemCountWithInspect",data:{data:JSON.stringify(d)},success:function(a){e.html(a.template)}})}}),e.on("click",".js-cancel",function(){return $(".js-pop-causes").children().length?void $(".js-pop-causes").children().addClass("show"):void M.ajax({url:"/api/order_query_causes",data:{data:JSON.stringify({type:1})},success:function(e){$(".js-pop-causes").html(e.template),$(".js-close,.mask").on("click",function(){$(".show").removeClass("show")}),$(".js-submit-causes").off().on("click",function(){M.ajax({url:"/api/order/orderByInspectCancel",data:{data:JSON.stringify({orderNo:t})},success:function(e){200==e.success_code&&history.length&&window.history.go(-1)}})})}})})}},w={url:"/order/settlement.htm",render:function(a){e.renderModule("orderSettlement",a)},bind:function(){}};a.push(t).push(r).push(i).push(s).push(n).push(p).push(f).push(h).push(v).push(m).push(g).push(y).push(S).push(o).push(c).push(l).push(u).push(d).push(b).push(w).setDefault("/index").init()},getAddressData:function(e){var a=$("#app"),t={consignee:e.find(".name").val(),phone:e.find(".mobile").val(),district:e.find(".district").val(),areaId:e.find(".district").data("area-id")||null,prv:$("#list-pro").find("option:selected").text(),city:$("#list-city").find("option:selected").text(),area:$("#list-area").find("option:selected").text(),gpsAddr:e.find(".street").val(),lat:e.find(".street").data("lat")||null,lng:e.find(".street").data("lng")||null,addrDetail:e.find(".house-number").val(),isDefault:e.find(".isDefault").is(":checked")?1:0};console.log(JSON.stringify(t));var r=e.data("id");return r&&(t.deliveryAddrId=r),a.data("data",t),t},bindAddressEvents:function(a){var t=a;require.async("app/choose_pcd",function(a){var r=$(".js-district");new a({container:$(".spa"),trigger:r,confirmed:function(a){var i=[a.proName,a.cityName,a.areaName].join("");r.val()!==i&&(r.val(i),$(".house-number,.street").val("")),e.getAddressData($(".fm-addr-info")),e.updateAddressData(t)}}).init()}),t.on("click",".js-street",function(){var a=$(".js-district");if(!a.data("area-id"))return M.tips("请先选择省市区");var t=e.getAddressData($(".fm-addr-info")),r="/center#/addressSearch/"+t.areaId+"/"+(a.data("pro-name")||"");location.href=r}),t.on("click",".js-gps",function(){e.getAddressData($(".fm-addr-info")),location.href="/center#/addressGps"}),t.on("click",".js-delete",function(){var a={deliveryAddrId:$(this).data("id")};confirm("您确定删除该地址吗",function(t){M.ajax({url:e.config.api.addressDelete,data:{data:JSON.stringify(a)},success:function(e){if(e.success){t.hide();var r=localStorage.getItem(CONST.local_settlement_addr);r&&(r=JSON.parse(r),a.deliveryAddrId==r.deliveryAddrId&&localStorage.removeItem(CONST.local_settlement_addr)),M.tips({body:"收货地址删除成功！",callback:function(){history.go(-1)}})}}})})}),t.on("click",".js-submit",function(){var a=e.getAddressData($(".fm-addr-info")),r={consignee:"请输入收货人的姓名",phone:"请输入收货人的手机号码",phone_valid:"请输入正确的手机号码",areaId:"请选择省份、城市、区域",gpsAddr:"请选择街道地址",addrDetail:"请填写门牌号等详细地址"},i=!0;return $.each(a,function(e,t){if(/(consignee|phone|gpsAddr|addrDetail)/.test(e)){if(a[e]=$.trim(t),!a[e])return M.tips(r[e]),i=!1;if(a[e].match(/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g))return M.tips("不能输入特殊字符或表情"),i=!1;if(/(phone)/.test(e)&&!/^1[3,4,5,7,8]\d{9}$/.test(a[e]))return M.tips(r.phone_valid),i=!1}return/(areaId)/.test(e)&&!a[e]?(M.tips(r[e]),i=!1):/(lat|lng)/.test(e)&&!a[e]?(M.tips(r.gpsAddr),i=!1):void 0}),!!i&&void M.ajax({url:e.config.api.addressSave,data:{data:JSON.stringify(a)},success:function(e){e.success&&M.tips({body:"保存成功！",callback:function(){var r=t.data("hash-params");if(r.f){var i={deliveryAddrId:e.deliveryAddrId||a.deliveryAddrId,addr:[a.district,a.gpsAddr,a.addrDetail].join(""),consignee:a.consignee,phone:a.phone,areaId:a.areaId,isDefult:a.isDefault};localStorage.setItem(CONST.local_settlement_addr,JSON.stringify(i)),window.history.go(-2)}else window.history.go(-1)}})}})})},updateAddressData:function(module){var e=$("#app"),a=module,t=e.data("data");t&&("undefined"!=typeof t.gpsAddr&&a.find(".street").val(t.gpsAddr).data({lat:t.lat,lng:t.lng}),"undefined"!=typeof t.consignee&&a.find(".name").val(t.consignee),"undefined"!=typeof t.phone&&a.find(".mobile").val(t.phone),"undefined"!=typeof t.district&&a.find(".district").val(t.district).data({"area-id":t.areaId,"pro-name":t.prv,"city-name":t.city,"area-name":t.area}),"undefined"!=typeof t.addrDetail&&a.find(".house-number").val(t.addrDetail),"undefined"!=typeof t.isDefault&&a.find(".isDefault").prop("checked",!!t.isDefault))},renderModule:function(module,a,t){var r=require("app/renderSPA");r(e.config.api[module],a,t)}};e.init()});