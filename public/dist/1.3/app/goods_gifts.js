define(function(require,exports,module){var t={config:{params:M.url.params(),hashParams:function(){return M.url.getParams((location.hash.match(/(\w+=)([^\&]*)/gi)||[]).join("&"))}},init:function(e){t.bindEvents()},bindEvents:function(){var e=$("#app");e.on("click",".js-sku",t.selectSku),e.on("change",".item :radio",function(){var t=$(this).closest(".item");$(this).is(":checked")&&t.addClass("selected").siblings().removeClass("selected")}),e.on("click",".js-addToCart",t.addToCart),e.on("click",".mask, .js-close",function(){$(this).closest(".u-fixed").removeClass("show")}),e.on("click",".js-sku-confirm",function(){var t=$(this),e=$(".js-sku.current").closest(".item");require.async("app/sku",function(a){var s=a.selected();if(!s.itemId){var i=$.map($(".sku dl dt"),function(t){if(!$(t).closest("dl").find(".sku-key.active")[0])return $(t).text()})[0];return M.tips("请选择"+i)}e.data("item-id",s.itemId).data("count",s.detail.promotionSkuCount).find(".sku-edit").addClass("selected").text("已选"+s.desc.join(",")).end().find(".pic img").attr("src",s.detail.itemPic).end().find(".desc sub").text("x"+s.detail.promotionSkuCount),t.closest(".u-sku").find(".js-close").trigger("click")})})},selectSku:function(){var e=t.config,a=$(this),s=a.data("template-id"),i=e.params.reservedNo;if(a.hasClass("current"))return $(".u-sku").addClass("show"),!1;$(".js-sku").removeClass("current");var n={inlet:a.closest(".main-product")[0]?9:10,reservedNo:i,templateId:s},c=JSON.parse(localStorage.getItem(CONST.local_detail_location));c&&(n.areaId=c.areaId,n.lat=c.lat,n.lng=c.lng),M.ajax({location:!0,url:"/api/goods_sku",data:{data:JSON.stringify(n)},success:function(t){$(".u-sku").find(".content").empty().append(t.template).find(".quantity, .sku-sales").remove().end().end().addClass("show"),require.async("app/sku",function(t){t.init($(".sku")),a.addClass("current")})}})},addToCart:function(){for(var e=t.config,a=localStorage.getItem(CONST.local_cartId),s=$(".item.selected"),i=0;i<s.length;i++){var n=$(s[i]);if(!n.data("item-id"))return n.is(".main-product")?M.tips("请选择主商品的商品规格"):M.tips("请选择赠品的商品规格"),!1}var c=$.map(s,function(t,e){return{isBindShop:!1,templateId:$(t).data("template-id"),itemId:$(t).data("item-id"),count:+$(t).data("count"),isGift:!$(t).is(".main-product"),pmtCode:0}}),o={cartId:a,jsonTerm:JSON.stringify(c),pmtType:6,reservedNo:e.params.reservedNo};M.ajax({location:!0,url:"/api/addToCart",data:{data:JSON.stringify(o)},success:function(t){return 200!=t.success_code?M.tips(t.msg):(localStorage.setItem(CONST.local_cartId,t.cartId),M.tips({class:"true",body:"加入购物车成功"}),$(".u-sku .js-close").trigger("click"),void 0)}})}};t.init()});