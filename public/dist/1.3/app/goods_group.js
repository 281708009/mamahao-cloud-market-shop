define(function(require,exports,module){var t={config:{params:M.url.params(),hashParams:function(){return M.url.getParams((location.hash.match(/(\w+=)([^\&]*)/gi)||[]).join("&"))}},init:function(a){t.config;t.bindEvents()},bindEvents:function(){var a=$("#app");a.on("click",".js-collapse",function(){var t=$(this);t.closest(".item").toggleClass("in")}),a.on("click",".js-sku",t.selectSku),a.on("click",".js-addToCart",t.addToCart),a.on("click",".mask, .js-close",function(){$(this).closest(".u-fixed").removeClass("show")}),a.on("click",".js-sku-confirm",function(){var t=$(this),a=$(".js-sku.current").closest(".goods"),e=a.closest(".item");require.async("app/sku",function(s){var i=s.selected();if(!i.itemId){var c=$.map($(".sku dl dt"),function(t){if(!$(t).closest("dl").find(".sku-key.active")[0])return $(t).text()})[0];return M.tips("请选择"+c)}if(a.attr("data-item-id",i.itemId).attr("data-price",i.detail.price).attr("data-oprice",i.detail.oprice).find(".spec").addClass("selected").text("已选"+i.desc.join(",")).end().find(".pic img").attr("src",i.detail.itemPic),t.closest(".u-sku").find(".js-close").trigger("click"),e.find(".goods[data-price]").length===e.find(".goods").length){var o=+e.data("discount"),d=0;$.each(e.find(".goods"),function(){var t=+$(this).data("count"),a=$(this).attr("data-oprice")||$(this).attr("data-price"),e=M.calc.multiply(a,t);d=M.calc.add(d,e)}),e.find(".header em, .footer dt strong").text("￥"+M.calc.subtract(d,o)),e.find(".footer dd del").text("原价：￥"+d)}})})},selectSku:function(){var t=$(this),a=t.closest(".item"),e=t.closest(".goods"),s=e.data("template-id");if($(".js-sku").removeClass("current"),t.addClass("current"),s===$(".js-sku-confirm").data("template-id"))return $(".u-sku").addClass("show"),!1;var i={inlet:6,reservedNo:a.data("no"),templateId:s},c=JSON.parse(localStorage.getItem(CONST.local_detail_location));c&&(i.areaId=c.areaId,i.lat=c.lat,i.lng=c.lng),M.ajax({location:!0,url:"/api/goods_sku",data:{data:JSON.stringify(i)},success:function(t){$(".u-sku").find(".content").empty().append(t.template),require.async("app/sku",function(t){t.init($(".sku")),$(".quantity, .sku-sales").hide(),$(".js-sku-confirm").data("template-id",s),$(".u-sku").addClass("show")})}})},addToCart:function(){var t=$(this),a=t.closest(".item"),e=a.find(".goods"),s=localStorage.getItem(CONST.local_cartId);if(a.find(".goods[data-item-id]").length<e.length)return M.tips("请选择套餐的商品规格");var i=$.map(e,function(t,a){return{isBindShop:!1,templateId:$(t).data("template-id"),itemId:$(t).data("item-id"),count:+$(t).data("count")}}),c={cartId:s,jsonTerm:JSON.stringify(i),pmtType:4,reservedNo:t.closest(".item").data("no")};M.ajax({location:!0,url:"/api/addToCart",data:{data:JSON.stringify(c)},success:function(t){return 200!=t.success_code?M.tips(t.msg):(localStorage.setItem(CONST.local_cartId,t.cartId),M.tips("套餐已成功添加到购物车"),$(".u-sku .js-close").trigger("click"),void 0)}})}};t.init()});