define(function(require,exports,module){var e={config:{api:{inspectSettlement:""}},elements:{},init:function(){var e=this,t=(e.config,e.elements);t.confirmBtn=$(".js-btn-confirm"),t.module=$("#app"),e.bind()},renderDeliveryAddr:function(e){if(e){var t=[];t.push('<a class="u-arrow right" href="/center#/address/f=1&amp;id='+e.deliveryAddrId+'">'),e.isDefult?t.push('<dl class="default"><dt><strong>'):t.push("<dl><dt><strong>"),t.push(e.consignee+"</strong><em>"+e.phone+"</em></dt><dd>"+e.addr),t.push("</dd></dl></a>"),$(".js-address").html(t.join("")),$('[name="deliveryAddrId"]').val(e.deliveryAddrId)}},stockOutHandler:function(e,t){if(14001==e||3119==e)location.href="/cart";else if(t&&t.length>0){var a=['<div class="goods-list"><ul>'];for(i=0;i<t.length;i++){var s=t[i],n="";$.each(s.spec,function(e){e>0&&(n+=","),n+=this.value}),a.push("<li>"),a.push('<div class="pic"><img src="'+s.itemPic+'@1e_200w_200h_0c_0i_0o_100q_1x.jpg"><em>暂时缺货</em></div>'),a.push("<dl><dt>"+s.itemTitle+"</dt><dd><span>"+n+"</span>"),s.isGift?a.push("<em>赠品</em>"):a.push("<strong>￥"+s.showPrice+"</strong>"),a.push("</dd></dl></li>")}a.push("</ul></div>"),M.dialog({className:"m-cart-lack",title:"您选购的以下商品缺货",body:a.join(""),buttons:[{text:"找相似商品",class:"",onClick:function(){location.href="/"}},{text:"继续结算",class:"success",onClick:function(){this.hide(),M.reload()}}]})}else{var d=localStorage.getItem(CONST.local_settlement_addr);d&&(d=JSON.parse(d)),d?M.dialog({body:"商品在该区域暂时缺货",buttons:[{text:"修改地址",class:"",onClick:function(){location.href="/center#/address/f=1&id="+d.deliveryAddrId}},{text:"我知道了",class:"success",onClick:function(){this.hide(),history.length?history.go(-1):location.reload()}}]}):M.dialog({body:"商品在该区域暂时缺货",buttons:[{text:"找其他商品",class:"",onClick:function(){location.href="/"}},{text:"我知道了",class:"success",onClick:function(){this.hide(),history.length?history.go(-1):location.reload()}}]})}},bind:function(){var e=this,t=(e.config,e.elements),a=$("#settlement"),s=a.data("stockout");if(s&&0!=s)return void e.stockOutHandler(s,a.data("stockoutGoods"));var i=localStorage.getItem(CONST.local_settlement_addr);if(i){var i=JSON.parse(i);e.renderDeliveryAddr(i);var n=$('[name="reqParams"]').val();n.deliveryAddrId=i.deliveryAddrId,M.ajax({location:!1,url:"/api/isSupportInspect",data:{data:n},success:function(e){$(".js-ctn-selection").html(e.template),localStorage.removeItem(CONST.local_settlement_addr)}})}t.module.on("click",".js-btn-confirm",function(){var e=$('[name="deliveryAddrId"]').val(),t=$('[name="dealingType"]:checked').val();$('[name="deliveryWay"]').val(),$('[name="shopId"]').val(),$('[name="warehouseId"]').val();if(!t)return alert("请选择支付方式");if(!e)return M.dialog({body:"您还没有选择收货地址",buttons:[{text:"取消",class:"",onClick:function(){this.hide()}},{text:"选择地址",class:"success",onClick:function(){location.href="/center#/address/f=1"}}]}),!1;var a={orderBatchNo:+$('[name="orderNo"]').val(),dealingType:+t,deliveryAddrId:+e,deliveryWays:$('[name="deliveryWay"]').val()},s=JSON.parse($('[name="reqParams"]').val());2==t?M.dialog({body:$('[name="inspectTopayAlert"]').val(),buttons:[{text:"暂不下单",class:"",onClick:function(){this.hide()}},{text:"继续下单",class:"success",onClick:function(){M.ajax({location:!0,url:"/api/checkoutByInspect",data:{data:JSON.stringify(a)},success:function(e){$(".spa").html(e.template)}})}}]}):(s.deliveryAddrId=a.deliveryAddrId,location.href="/settlement#/checkout/"+$.param(s))})}};module.exports=e});