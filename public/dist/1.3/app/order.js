define(function(require,exports,module){function t(t,o){this.page=t,this.container=o}module.exports=t,t.prototype.render=function(){var t=this,o=t.page;t.container.is(".m-order")&&(M.swipe.init(),$.pagination({keys:{count:"count"},container:".ui-swipe-item .list",api:o.config.api.orders,fnSuccess:function(t,o){var n=t.data;if(!n.template)return o.data("locked",!0);var e=$(n.template);o.append(e),e.find(".js-countdown").each(function(){var t=$(this);t.timeCountDown({second:t.data("seconds"),callback:function(){t.remove()}})})}})),t.bind()},t.prototype.bind=function(){var t=this,o=t.container;o.on("click",".js-order-detail",function(t){location.href=$(this).attr("url")}),o.on("click",".js-goods",function(t){t.stopPropagation(),location.href="/goods/detail/?inlet=6&templateId="+$(this).data("infos").templateId+"&itemId="+$(this).data("infos").itemId}),o.on("click",".u-btn, .u-checkbox",function(t){t.stopPropagation()}),$(".js-countdown").each(function(){var t=$(this);t.timeCountDown({second:t.data("seconds"),callback:function(){1==t.data("pageType")?(t.remove(),t.closest(".item").find(".js-option").html('<li><button class="u-btn ban">已经失效</button></li>')):(t.html("订单已失效，请重新生成。").removeClass("shot"),t.closest("dl").find(".u-btn").remove(),t.closest("dl").append('<button class="u-btn ban"> 订单失效</button>'))}})}),o.on("click",".js-btn-del",function(){var t=$(this).closest(".item"),o={orderNo:$(this).data("id")};confirm("是否确认删除订单",function(){M.ajax({url:"/api/order/orderDelete",data:{data:JSON.stringify(o)},success:function(o){M.tips("删除成功"),t.length?t.remove():location.href="/center#/orders"}}),this.hide()})}),o.on("click",".js-btn-cancel",function(){var t=($(this).closest(".item"),$(this).data("id")),o={orderNo:t};confirm("您确定取消订单",function(){M.ajax({url:"/api/order/orderCancel",data:{data:JSON.stringify(o)},success:function(t){window.location.href="/center#/orders"}}),this.hide()})}),o.on("click",".js-btn-intercept",function(){var t=$(this).data("id"),o=$(this).data("lineId");return $(".js-pop-causes").children().length?void $(".js-pop-causes").children().addClass("show"):void M.ajax({url:"/api/order_query_causes",data:{data:JSON.stringify({type:2})},success:function(n){$(".js-pop-causes").html(n.template),$(".js-close,.mask").on("click",function(){$(".show").removeClass("show")}),$(".js-submit-causes").off().on("click",function(){var n={orderNo:t,orderLineId:o,causeId:+$('[name="causeId"]:checked').val(),causeDes:$('[name="causeId"]:checked').next().html()};M.ajax({url:"/api/order/orderIntercept",data:{data:JSON.stringify(n)},success:function(t){M.tips({body:"取消成功",delay:1e3,class:"true"}),location.reload()}})}),M.tools.isAndroid&&require.async("jquery/iscroll-lite",function(t){new IScroll(".m-returns-pop .i-scroll")})}})}),o.on("click",".js-btn-remind",function(){var t=($(this).closest(".item"),{orderNo:$(this).data("id")});M.ajax({url:"/api/order/orderRemind",data:{data:JSON.stringify(t)},success:function(t){M.tips({body:"提醒成功",delay:1e3,class:"true"})}})}),o.on("click",".js-btn-shop",function(){var t=JSON.stringify({orderNo:$(this).data("id"),shopId:$(this).data("shopId")});M.ajax({url:"/api/order/shopInfo",data:{data:t},success:function(t){console.log(t);var o=['<div class="dialog-delivery-info">'];o.push("<p><strong>门店名称：</strong><em>"+t.shopName+"</em></p>"),o.push("<p><strong>门店地址：</strong><em>"+t.addr+"</em></p>"),o.push("<p><strong>营业时间：</strong></p>"),o.push("<p><strong>工作日：</strong><em>"+t.workTime+"</em></p>"),o.push("<p><strong>节假日：</strong><em>"+t.holiday+"</em></p>"),o.push('<p><strong>联系方式：</strong><em><a href="tel:'+t.telephone+'">'+t.telephone+"</a></em></p>"),o.push("</div>"),M.dialog({body:o.join(""),buttons:[{text:"确定",class:"alone",onClick:function(){this.hide()}}]})}})}),o.on("click",".js-btn-delivery",function(){var t=JSON.stringify({orderNo:$(this).closest(".item").data("id"),shopId:$(this).data("shopId")});M.ajax({url:"/api/order/deliveryInfo",data:{data:t},success:function(t){console.log(t);var o=['<div class="dialog-delivery-info">'];o.push("<p><strong>门店名称：</strong><em>"+t.shopName+"</em></p>"),o.push("<p><strong>配送人：</strong><em>"+t.deliveryStaff+"</em></p>"),o.push("<p><strong>预计送达时间：</strong><em>"+t.text+"</em></p>"),o.push('<p><strong>联系方式：</strong><a href="tel:'+t.phone+'">'+t.phone+"</a></p>"),o.push("</div>"),M.dialog({body:o.join(""),buttons:[{text:"我知道啦",class:"alone",onClick:function(){this.hide()}}]})}})}),o.on("click",".js-btn-receive",function(){var t=($(this).closest(".item"),$(this).data("id")),o=JSON.stringify({orderNo:t});confirm("是否确认收货",function(){M.ajax({url:"/api/order/orderReceive",data:{data:o},success:function(o){o.success?location.href="/center#/order/result/orderNo="+t:alert(o.msg)}}),this.hide()})}),o.on("click",".refund-explain",function(){M.dialog({body:'如需退换货请您下载并登录“妈妈好APP"申请',buttons:[{text:"我知道了",class:"",onClick:function(){this.hide()}},{text:"下载APP",class:"success",onClick:function(){this.hide(),location.href="http://app.mamahao.com"}}]})});var n=function(t){var o=localStorage.getItem(CONST.local_cartId),n={cartId:o,jsonTerm:JSON.stringify(t),pmtType:0};console.log(n),M.ajax({location:!0,url:"/api/addToCart",data:{data:JSON.stringify(n)},success:function(t){200==t.success_code&&(localStorage.setItem(CONST.local_cartId,t.cartId),location.href="/cart#/")}})};o.on("click",".js-rebuy",function(){var t=[];$(".js-goods").each(function(){if($(this).find(":checked").length){var o=$(this).data("infos");o.count=1,o.isBindShop=!1,t.push(o)}}),n(t)}),o.on("click",".js-single-rebuy",function(){var t=[],o=$(this).closest(".js-goods"),e=o.data("infos");e.count=1,e.isBindShop=!1,t.push(e),n(t)}),o.on("click",".js-topay",function(){M.pay.order($(this).data("orderNo"))}),o.on("click",".js-footer-rebuy",function(){var t=$(this),o=$(".js-goods").length;if(o>1)window.location.href="#/order/rebuy/"+t.data("order");else{var e=[],s=$(".js-goods").eq(0),i=s.data("infos");i.count=1,i.isBindShop=!1,e.push(i),n(e)}}),o.on("click",".js-btn-inspect",function(){var t=$(this);window.location.href="#/order/cart/"+t.data("id")})}});