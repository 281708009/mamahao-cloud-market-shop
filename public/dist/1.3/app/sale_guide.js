define(function(require,exports,module){var i={config:{params:M.url.params(),imgSize:"@1e_300w_300h_0c_0i_0o_100q_1x.jpg"},info:{},init:function(){var i=this,t=i.info,e=i.config;t.elems=$(".m-shopping-all"),t.quality=$(".js-quality"),t.goods=$(".js-goods"),t.tools=$(".js-tools"),t.similar=$(".js-similar"),e.params=M.url.params(),e.vm=VM,M.tools.isMamahao?(APP.config.Bottom.data=[{type:1,system:1},{type:1,system:2},{type:1,system:4},{type:1,system:5}],APP.config.refresh=!1,SDK.tools.callpush.push({i:10,f:"topcar"},{i:98,f:"refresh"})):t.elems.prepend('<div class="history-back"><a href="//'+location.host+'/sale/">妈妈好 - 每月购</a><div'),i.bind(),i.quality(),i.getItems(),i.easemobim(),i.weixin({title:e.vm.share.title,desc:e.vm.share.subTitle,content:e.vm.share.subTitle,image:e.vm.share.icon})},bind:function(){var t=this,e=t.info,a=t.config,s=$("#app");e.quality.length&&e.quality.on("click",function(){M.tools.isMamahao?APP.open("photo"):M.tools.isWeixin&&require.async("weixin",function(i){i.previewImage(a.wxPhoto)})}),$("#app").on("click",".js-open-item",function(i){var e=$(i.target),a=$(this),o=a.data("itemid"),n=a.data("templateid");M.tools.isMamahao?e.hasClass("js-sku")?(APP.config.Sku={inlet:6,templateId:n},APP.open("sku")):(APP.config.Detail={itemId:o,templateId:n},APP.open("detail")):M.tools.isWeixin?e.hasClass("js-sku")?require.async("app/sku",function(i){i.init(s.find(".sku")),s.find(".u-quantity .number").spinner(),$(".sku-sales").hide(),s.find(".u-sku").addClass("show")}):window.location.href="/goods/detail/?vip=1&inlet=6&templateId="+n+"&itemId="+o:t.download()}),s.on("click",".mask, .js-close",function(){$(this).closest(".u-fixed").removeClass("show")}),s.on("click",".sku-sales dd a",function(){var i=$(this);i.addClass("active").siblings().removeClass("active")}),s.on("click",".js-sku-confirm",function(){i.addToCart()}),e.tools.on("click",".js-single-artificial",function(){M.tools.isMamahao?(APP.config.Easemob=a.easemob,APP.open("easemob")):M.im.track(a.easemob.data)}),e.tools.on("click",".js-item",function(){e.goods.find(".js-open-item").trigger("click")}),e.similar.on("click","a",function(){var i={groupId:$(this).data("id"),keyword:$(this).data("name")};M.tools.isMamahao?(APP.config.Search={entry:3,groupId:i.groupId,keyword:i.keyword},APP.open("search")):window.location.href="/sale/similar/?"+$.param(i)})},addToCart:function(){var t=i.config,e=t.params;require.async("app/sku",function(i){var t=i.selected();if(!t.itemId){var a=$.map($(".sku dl dt"),function(i){if(!$(i).closest("dl").find(".sku-key.active")[0])return $(i).text()})[0];return M.tips("请选择"+a)}var s=localStorage.getItem(CONST.local_cartId),o={cartId:s,jsonTerm:JSON.stringify([{isBindShop:!!e.shopId,itemId:t.itemId,templateId:e.styleNumId,count:+$(".u-sku .u-quantity .number").text(),pmtCode:1}]),pmtType:0};M.ajax({location:!0,url:"/api/addToCart",data:{data:JSON.stringify(o)},success:function(i){return 200!=i.success_code?M.tips(i.msg):(localStorage.setItem(CONST.local_cartId,i.cartId),M.tips({class:"true",body:"加入购物车成功"}),$(".u-sku .js-close").trigger("click"),localStorage.setItem(CONST.local_cart_newGoods,1),void 0)}})})},quality:function(){var i=this,t=i.info,e=i.config,a=t.quality.data("json");t.quality.length&&(M.tools.isMamahao&&(APP.config.photo={data:a,index:0}),e.wxPhoto={current:a[0],urls:a})},getItems:function(){var i=this,t=i.info,e=i.config,a=t.elems.find(".ke-items");if(a.length){e.items=[],$.each(a,function(){var i=$(this),t=i.attr("alt");e.items.push(t),i.after('<div class="js-ke-item" data-item-id="'+t+'"></div>'),i.remove()});var s={styleNumIds:e.items.join(","),vipInfoShow:!0};M.ajax({url:"/api/sale/guide_items/",data:{data:JSON.stringify(s)},success:function(t){i.setItems(t)}})}},setItems:function(i){for(var t=this,e=(t.info,t.config),a=i,s=0,o=a.length;s<o;s++)if(0!=a[s].online){var n=[];n.push('<div class="item js-open-item" data-itemid="'+a[s].itemId+'" data-templateid="'+a[s].templateId+'">'),n.push('<div class="pic"><img src="'+a[s].pic+e.imgSize+'" /></div>'),n.push("<dl><dt>"+a[s].title+"</dt>"),n.push("<dd><strong>￥"+a[s].price+"</strong><p>"),n.push("</p></dd></dl></div>"),$(".js-ke-item[data-item-id="+a[s].templateId+"]").html(n.join(""))}else $(".js-ke-item[data-item-id="+a[s].templateId+"]").remove()},download:function(){M.dialog({body:"喜欢该商品？<br>赶紧下载妈妈好App购买吧！",buttons:[{text:"朕再想想"},{text:"立即下载",class:"success",onClick:function(){window.location.href="http://app.mamahao.com/"}}]})},weixin:function(i){M.tools.isWeixin?require.async("weixin",function(t){M.wx.share(t,{title:i.title,url:location.href,image:i.image,desc:i.desc})}):M.tools.isMamahao&&$.extend(APP.config.Share.data,i)},easemobim:function(){var i=this,t=i.info,e=i.config;e.easemob={type:3,data:{title:"我正在看每月购商品：",price:"查看详情",desc:t.goods.find("dt").text(),img_url:t.goods.find("img").attr("src")||"//img.mamhao.cn/s/common/images/icon-114.png",item_url:window.location.href}},M.im.easemobim||M.tools.isMamahao||M.im.init()}};i.init(),module.exports=i});