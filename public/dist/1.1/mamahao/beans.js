define(function(require,exports,module){var o={};o.extend=function(o){return o},o.userAgent=navigator.userAgent.toLowerCase(),o.tools={orientationSupport:!!window.DeviceOrientationEvent};var e=o.extend({config:{},info:{},start:function(){var o=this;require.async("imagesloaded",function(e){o.init()})},init:function(){var o=this,e=o.info,t=o.config;try{APP.config.refresh=!1,APP.open("refresh")}catch(o){console.log(o)}e.doc=$(document),e.doc.on("touchmove",function(o){o.preventDefault()},!1),e.loading=$(".js-loading"),e.main=$(".A-main-all"),e.block=e.main.children(".A-block"),e.ratio=$(".ratio"),e.mountain=$(".mountain"),e.tree=$(".tree-block"),e.girl=$(".girl"),e.tip=$(".tip"),e.myBeans=$("#my-beans"),e.share=$(".js-share"),t.gamepoint=0,t.maxHeight=1334,t.width=parseInt(e.doc.width()),t.height=parseInt(e.doc.height()),t.ratio=t.height/t.maxHeight,t.margintop=0-(t.maxHeight-parseInt(t.height))/2,t.isError=!1,t.error={8001:{h1:"机会用完了",content:"<div>今天机会用完了哦，明天再来试试吧~每天还有2次机会邀请好友帮忙摇妈豆，获得更多妈豆哦~</div>",button:"<button onclick=\"page.open('share');\">邀请好友</button>"},8005:{h1:"机会用完了",content:'<div class="t2" style="text-align:center;">没有摇到哦。<br>你的好友已在用妈豆抵现，购物更省~</div>',button:"<button ontouchend=\"page.open('beans');\">我也要摇妈豆</button>"}},t.audio=new Audio,t.audio.src="http://img.mamhao.cn/s/app/static/mp3/shake.mp3",t.audio.loop=!1,t.audio.preload="auto",t.audio.autoplay=!1,t.audio.controls=!1,t.API="http://"+(M.tools.search("http")||"api.mamahao.com"),t.user={port:M.tools.isMamahao,id:M.tools.search("memberId")||M.tools.search("r")},t.user.id&&!t.user.port&&(t.user.friend=!0);var n={callback:!1,content:"速来围观！我刚摇下一大波金豆子，可以直接兑换成现金使用！",desc:"速来围观！我刚摇下一大波金豆子，可以直接兑换成现金使用！",image:"http://img.mamhao.cn/s/app/beans/images/share.jpg",title:"快来摇，你有1棵摇钱树",url:"http://m.mamahao.com/beans/?r="+VM.id};M.tools.isMamahao?(APP.config.refresh="true",SDK.tools.callpush.push({i:5,f:"refresh"}),APP.config.Bottom.data.unshift({type:1,system:1},{type:1,system:2},{type:1,system:4}),MMH.Audio({src:t.audio.src}),$.extend(APP.config.Share.data,n)):M.tools.isWeixin&&require.async("weixin",function(o){M.wx.share(o,n)}),o.size(),o.load(),t.height>1e3&&o.prize(),o.bindEvents()},bindEvents:function(){var o=this,e=o.info;o.config;console.log("bindEvents"),$(".js-explain").on("click",function(){o.showHelp()}),e.share.on("click",function(){e.share.removeClass("show")}),$(".js-beans-record").on("click",function(){o.open("beansannal")}),$(".js-login").on("click",function(){o.open("login")})},size:function(){var o=this,e=o.info,t=o.config,n=t.margintop>0?0:t.margintop,i=parseInt(e.tree.css("margin-top"))-n/4;e.mountain.css({bottom:n/1.5}),e.girl.css({bottom:n/1.5}),e.tree.css("margin-top",i),e.tip.css({bottom:170+n/1.5});var a=parseFloat(t.ratio).toFixed(2);e.ratio.css({"-webkit-transform":"scale("+a+")",transform:"scale("+a+")"})},load:function(){var o=this,e=(o.info,o.config),t=$("img"),n=t.length,i=0;t.each(function(){imagesLoaded($(this),function(){i++;Math.floor(i/n*100);n!=i||e.isLoad||o.loadend()})}),setTimeout(function(){e.isLoad||o.loadend()},1e4)},loadend:function(){var o=this,e=o.info,t=o.config;t.isLoad||(t.isLoad=!0,t.gamevalue=0,e.loading.hide())},shake:function(o){var t=e,n=(t.info,t.config),i=o.accelerationIncludingGravity;if(n.gamevalue!=-1&&void 0!=n.gamevalue)return Math.abs(n.gamepoint-i.x)>5&&(n.gamepoint=i.x,n.gamevalue++),n.gamevalue>5?(n.gamevalue=-1,setTimeout(function(){t.getTree()},500),void(M.tools.isMamahao?APP.open("shake"):n.audio.play())):void 0},getTree:function(){var o=this,t=o.info,n=o.config;return n.isError&&!n.user.friend?o.error({code:n.isError}):(t.tree.removeClass("result").addClass("show"),void new e.json({url:"/api/shakeBeans",data:{id:n.user.id,friend:n.user.friend},success:function(e){return console.log(e),e.noLogin?(t.tree.removeClass("show"),o.showPOP({title:"title-3",h1:"请先登录",icon:"icon-2",content:"<p>您还未登录哦~请先登录~</p>",button:"<button onclick=\"page.open('login');\">点击登录</button>"})):(n.user.data=e.count,void setTimeout(function(){o.endTree()},1500))}}))},open:function(o){var e=this,t=e.info;e.config;switch(o){case"login":M.tools.isMamahao?APP.open("login"):location.href="/account/bind/?origin="+location.href;break;case"home":M.tools.isMamahao?APP.open("home"):location.href="http://"+location.host;break;case"share":M.tools.isMamahao?APP.open("share"):t.share.addClass("show");break;case"beans":location.href="http://"+location.host+"/beans/";break;case"beansannal":M.tools.isMamahao?APP.open("beansannal"):location.href="/center/#/beans"}},endTree:function(){var o,e=this,t=e.info,n=e.config;t.tree.removeClass("show"),n.user.data?(o={title:"title-1",h1:n.user.data+"妈豆",icon:"icon-1",content:n.user.friend?"<p>成功帮好友摇到"+n.user.data+"妈豆~</p>":"<div>妈豆已发放至您的个人账户，赶紧去购物吧~邀请好友一起帮忙摇妈豆，还有2次机会获得更多妈豆哦～</div>",button:n.user.friend?"<button ontouchend=\"page.open('beans');\">我也要摇妈豆</button>":'<button ontouchend="page.open(\'home\');" class="js-shop">购物</button><button onclick="page.open(\'share\');" class="js-invite">邀请</button>'},t.tree.addClass("result"),n.isError=n.user.port&&8001,setTimeout(function(){e.showPOP(o)},1500)):(o={title:"title-3",h1:"没有摇到哦",icon:"icon-2",content:"<p>力气还不够大哦~没有帮好友摇出妈豆~</p>",button:"<button ontouchend=\"page.open('beans');\">我也要摇妈豆</button>"},e.showPOP(o))},showPOP:function(o){var t=e,n=(t.info,t.config,[]);n.push('<div class="title"><s class="'+o.title+'"></s></div>'),n.push('<div class="h1">'+o.h1+"</div>"),n.push('<div class="icon"><s class="'+o.icon+'"></s></div>'),n.push('<div class="text">'+o.content+"</div>"),n.push('<div class="button">'+o.button+"</div>"),e.POP.show({template:n.join(""),closeback:function(){t.resetTree()}})},resetTree:function(){var o=e,t=o.info,n=o.config;n.gamevalue=0,t.tree.removeClass("result")},showHelp:function(){var o=e;o.info,o.config;o.showPOP({title:"title-3",h1:"妈豆说明",icon:"icon-1",content:"<div>妈豆是妈妈好平台金币，用户在妈妈好平台购物时可以使用妈豆抵扣一定金额</div>",button:'<button class="js-close">我知道啦</button>'})},error:function(o){var t=e,n=t.info,i=t.config,a=i.error[o.code],s={title:"title-3",h1:o.h1||"出错啦~",icon:"icon-2",content:"<p>"+o.msg+"</p>",button:i.user.port?'<button class="js-close">我知道啦</button>':"<button ontouchend=\"page.open('beans');\">我也要摇妈豆</button>"};a&&$.extend(s,a),i.isError||8001!=o.code&&8005!=o.code||(i.isError=o.code),setTimeout(function(){n.tree.removeClass("show"),t.showPOP(s)},1500)},prize:function(){var o=e,t=o.info,n=(o.config,t.tip.find("dd ul")),i=n.find("li").length,a=0;n.show(),i<2||setInterval(function(){a++,a>=i&&(a=0);var o="translateY("+-30*a+"px)";n.css({transform:o,"-webkit-transform":o})},2e3)},stopShake:function(){var o=e,t=o.config;t.gamevalue=-1}});e.POP={info:{},init:function(){var o=this,e=o.info;e.elems=$(".pop-all"),e.block=e.elems.find(".pop-block"),e.content=e.elems.find(".pop-content"),e.elems.on("touchstart",".js-close",function(){o.hide()}).show()},show:function(o){var t=this,n=t.info;$.extend(n,o),n.elems?n.elems.show():t.init(),e.config.gamevalue=-1,n.template&&n.content.html(n.template),n.block.removeClass("hide").addClass("show"),n.startback&&n.startback.call(n.startback,t)},hide:function(){var o=this,e=o.info;e.block.removeClass("show").addClass("hide"),setTimeout(function(){e.elems.hide()},500),e.closeback&&e.closeback.call(e.closeback,o)}},e.json=function(o){M.ajax({url:$.isArray(o.url)?[o.url.join("/")].join("/"):o.url,data:o.data,success:function(t){200!=t.code?e.error(t):$.isFunction(o.success)&&o.success.call(o.success,t)},error:function(o,t){e.error(),console.log(o)},complete:function(o,t){"timeout"==t&&e.error({h1:"请求超时啦~",msg:"摇妈豆的人太多了，请稍后再试哦~"})}})};var t=function(){"-90"==window.orientation||"90"==window.orientation?$(".orientation").show():$(".orientation").hide()};window.onorientationchange=t,window.addEventListener("devicemotion",e.shake),e.start(),window.page=e});