define(function(require,exports,module){var t={config:{api:{index:"/api/cart/",settlement:"/api/settlement"}},init:function(){require.async("router",t.setRouter),t.bindEvents()},bindEvents:function(){},setRouter:function(){var e=new Router({container:"#app",enter:"enter",leave:"leave",enterTimeout:250,leaveTimeout:250}),a={url:"/",render:function(e){a.params={cartId:localStorage.getItem(CONST.local_cartId)},e.loadingDelay=10,t.renderModule("index",e,a.params)},bind:function(){var t=$(this),e=$(".spa");t.on("click","#selectAll",function(t){t.stopPropagation();var n=$(this).is(":checked")?2:3,o=JSON.stringify($.extend(!0,a.params,{isSelected:n}));M.ajax({location:!0,url:"/api/cart/selectedCart",data:{data:o},success:function(t){e.html(t.template)}})}),t.on("click",'[type="checkbox"]',function(t){t.stopPropagation();var n=$(this).closest(".item"),o=$(this).is(":checked")?0:1,i=JSON.stringify($.extend(!0,a.params,{isSelected:o,compoentId:"undefined"!=typeof $(this).closest("li").data("compoentId")?$(this).closest("li").data("compoentId"):n.data("compoentId")}));M.ajax({location:!0,url:"/api/cart/selectedCart",data:{data:i},success:function(t){e.html(t.template)}})}),t.on("click",".js-del",function(t){t.stopPropagation();var n=$(this).closest(".item"),o=JSON.stringify($.extend(!0,a.params,{compoentType:$(this).closest("li").data("compoentType")||n.data("compoentType"),compoentId:"undefined"!=typeof $(this).closest("li").data("compoentId")?$(this).closest("li").data("compoentId"):n.data("compoentId")}));confirm("确认删除这个商品吗?",function(){this.hide(),M.ajax({location:!0,url:"/api/cart/removeCartItem",data:{data:o},success:function(t){e.html(t.template)}})})}),t.on("click",".js-update",function(t){t.stopPropagation();var n=$(this).closest(".item"),o=+$(this).data("count");if(o<=0||$(this).is(".disabled")){if($(this).data("tips"))return alert($(this).data("tips"))}else{var i=JSON.stringify($.extend(!0,a.params,{newCount:o,compoentId:"undefined"!=typeof $(this).closest("li").data("compoentId")?$(this).closest("li").data("compoentId"):n.data("compoentId")}));M.ajax({location:!0,url:"/api/cart/updateCartItemCount",data:{data:i},success:function(t){e.html(t.template)}})}}),t.on("click",".js-jump",function(){$(this).attr("url")&&(location.href=$(this).attr("url"))}),localStorage.removeItem(CONST.local_cart_newGoods)}},n={url:"/settlement/:params?",render:function(e){var a={},n=M.url.getParams(this.params.params);if(!$.isEmptyObject(n)){var o=JSON.parse(n.jsonTerm);a.inlet=n.inlet,a.jsonTerm=o}var i=localStorage.getItem(CONST.local_settlement_addr);i&&(i=JSON.parse(i),a.deliveryAddr=i),console.log(a),t.renderModule("settlement",e,a)},bind:function(){var e=$(this);require.async("app/settlement",function(a){new a(t,e).render()})}};e.push(a).push(n).setDefault("/").init()},renderModule:function(module,e,a){var n=require("app/renderSPA");n(t.config.api[module],e,a)}};t.init()});