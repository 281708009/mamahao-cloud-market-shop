define(function(e,n,a){!function(){$.throttle=function(e,n){var a=null;return function(){var t=this,i=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(t,i)},"number"!=typeof n?n:200)}},$.fn.transitionEnd=function(e){function n(o){if(o.target===this)for(e.call(this,o),a=0;a<t.length;a++)i.off(t[a],n)}var a,t=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],i=this;if(e)for(a=0;a<t.length;a++)i.on(t[a],n);return this}}(),function(){Date.prototype.format=function(e){var n={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in n)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[a]:("00"+n[a]).substr((""+n[a]).length)));return e},Array.prototype.unique=function(){for(var e=[],n={},a=this.length,t=0;t<a;t++){var i=this[t];"[object Object]"==Object.prototype.toString.call(this[t])&&(i=JSON.stringify(this[t])),n[i]||(e.push(this[t]),n[i]=1)}return e},Array.prototype.getIndex=function(e){for(var n=0,a=this.length;n<a;n++)if(this[n]==e)return n;return-1},Array.prototype.remove=function(e){var n=this.getIndex(e);return n!==-1?this.splice(n,1):null},Array.prototype.replaceArr=function(e,n){var a=this.getIndex(e);return a!==-1?this.splice(a,1,n):null}}(),function(){var n={tools:{isMamahao:/mamahao|mamhao/gi.test(navigator.userAgent),isWeixin:/micromessenger/gi.test(navigator.userAgent),isAlipay:/alipaydefined|aliapp|alipayclient/gi.test(navigator.userAgent),isAndroid:/android|huawei/gi.test(navigator.userAgent),isiPhone:/iphone|ipod|ipad/gi.test(navigator.userAgent),isMobile:function(e){return!!/^1{1,}[3,4,5,7,8]{1}\d{9}$/.test(e)},search:function(e){var n=location.search.match(new RegExp("[?&]"+e+"=([^&]*)(&?)","i"));return n?decodeURIComponent(n[1]):""}},config:{isAjax:{},api:/mamahao.com/gi.test(location.host)?"http://api.mamahao.com/":"http://api.mamhao.com/mamahao-app-api/",isWeixin:/micromessenger/gi.test(navigator.userAgent)},init:function(){$(function(){FastClick.attach(document.body),n.toTop.init()}),e.async("weixin",function(e){n.wx.init(e,{ready:function(){n.wx.share(e)}})})},showLoading:function(){var e=$(".loading");e[0]||(e=$('<div class="loading"><span><s></s></span></div>').appendTo(document.body)),e.stop().fadeIn()},hideLoading:function(){var e=$(".loading");e[0]&&e.stop().fadeOut()},ajax:function(a){function t(){var n=$.Deferred();return e.async("app/location",function(e){e.getLocation({success:function(e){n.resolve({location:$.param(e)})},fail:function(){n.reject()}})}),n.promise()}function i(e){var t={type:a.type||"POST",url:a.url||"/",headers:$.extend({ajax:!0},e||{}),data:a.data||{},timeout:2e4,success:function(e){if(console.log("ajax-success-typeof",typeof e),o.isAjax[a.url]=!1,e.error_code){var t=e.msg;return a.error?a.error.call(this,e):/^(-1|1001)$/.test(e.error_code)?n.tips({body:"您还未登录，请登录后再试！",callback:function(){location.href=(o.isWeixin?"/account/bind":"/login")+"?origin="+location.href}}):n.tips(t)}a.success&&a.success.call(this,e)},error:function(e){if(console.log("error--->",e),o.isAjax[a.url]=!1,a.error)a.error.call(this,e);else{var t=e.msg||e.statusText;n.tips(t)}},complete:function(e){n.hideLoading(),a.complete&&a.complete.call(this,e)}};null!==a.dataType&&(t.dataType=a.dataType),null!==a.cache&&(t.cache=a.cache),null!==a.processData&&(t.processData=a.processData),null!==a.contentType&&(t.contentType=a.contentType),$.ajax(t)}var o=n.config;if(o.showLoading="boolean"!=typeof a.showLoading||a.showLoading,o.loadingDelay="number"==typeof a.loadingDelay?a.loadingDelay:10,o.isAjax[a.url])return!1;o.isAjax[a.url]=!0;var s=setTimeout(function(){clearTimeout(s),o.isAjax[a.url]&&o.showLoading&&n.showLoading()},o.loadingDelay);a.location?$.when(t()).always(i):i()},tips:function(e){var n={elements:{},init:function(){var a=n.elements,t=['<div class="ui-mask ui-mask-transparent ui-tips-mask"></div>','<div class="ui-tips-wrap">','<div class="ui-tips">','<div class="ui-tips-bd"></div></div></div>'];$(document.body).append(t.join("")),a.mask=$(".ui-tips-mask"),a.wrapper=$(".ui-tips-wrap"),a.inner=$(".ui-tips"),a.bd=$(".ui-tips-bd");var i={delay:1500,callback:null};"[object Object]"!==Object.prototype.toString.call(e)?(i.body=""+e,n.params=i):n.params=$.extend({},i,e||{});var o=n.params;o.body&&a.bd.html(o.body),o.class&&a.inner.addClass(o.class),n.show();var s=setTimeout(function(){clearTimeout(s),n.hide()},o.delay)},show:function(){var e=n.elements;e.mask.add(e.inner).addClass("visible")},hide:function(){var e=n.elements,a=n.params;e.mask.removeClass("visible").transitionEnd(function(){e.mask.remove()}),e.inner.removeClass("visible").transitionEnd(function(){e.wrapper.remove()}),a.callback&&a.callback.call(this)}};n.init()},dialog:function(e){var n={elements:{},init:function(){var a=n.elements,t=['<div class="ui-mask ui-dialog-mask"></div>','<div class="ui-dialog-wrap">','<div class="ui-dialog-inner">','<div class="ui-dialog-hd"></div>','<div class="ui-dialog-bd"></div>','<div class="ui-dialog-ft"></div>',"</div></div>"];a.dialog=$(t.join("")).appendTo($(".spa")[0]?$(".spa"):document.body),a.mask=$(".ui-dialog-mask"),a.wrapper=$(".ui-dialog-wrap"),a.inner=$(".ui-dialog-inner"),a.hd=$(".ui-dialog-hd"),a.bd=$(".ui-dialog-bd"),a.ft=$(".ui-dialog-ft");var i={body:"模态框内容",buttons:[{text:"取消",class:"",onClick:null},{text:"确定",class:"success",onClick:null}]};"[object Object]"!==Object.prototype.toString.call(e)&&(e={body:e+""});var o=n.params=$.extend({},i,e||{});a.bd.html(o.body),o.className&&a.inner.addClass(o.className),o.title&&a.hd.html(o.title),a.ft.empty().append(function(){return $.map(o.buttons,function(e,n){var a=["u-btn",e.class].join(" ");return['<button class="'+a+'">'+e.text+"</button>"]}).join("")}),n.show()},show:function(){var e=n.elements,a=n.params;e.mask.add(e.inner).show().addClass("visible"),e.ft.on("click",".u-btn",function(e){var t=$(this).index(),i=a.buttons[t].onClick;i&&$.isFunction(i)?i.call(n,n):n.hide()})},hide:function(){var e=n.elements;e.mask.removeClass("visible").transitionEnd(function(){e.mask.remove()}),e.inner.removeClass("visible").transitionEnd(function(){e.wrapper.remove()}),e.ft.find(".u-btn").off("click")}};n.init()},dropLoad:function(e){var n=$(".dropload");n[0]&&n.pullToRefresh().on("pull-to-refresh",function(){e.callback?e.callback.call(this,n):function(){var e=setTimeout(function(){clearTimeout(e),n.pullToRefreshDone()},500)}()})},calc:function(){function e(e){e=+e;var n={num:e,times:1};if(e!==(0|e)){var a=(""+e).split("."),t=a[1].length;n.times=Math.pow(10,t),n.num=Math.round(e*n.times)}return n}function n(n,a,t){var i,o=e(n),s=e(a),c=o.num,r=o.times,l=s.num,d=s.times,u=Math.max(r,d);switch(t){case"add":i=r>d?c+l*(r/d):l+c*(d/r),i/=u;break;case"subtract":i=r>d?c-l*(r/d):c*(d/r)-l,i/=u;break;case"multiply":return i=c*l/(r*d);case"divide":return i=c/l*(d/r)}return i}function a(e,a){return n(e,a,"add")}function t(e,a){return n(e,a,"subtract")}function i(e,a){return n(e,a,"multiply")}function o(e,a){return n(e,a,"divide")}return{add:a,subtract:t,multiply:i,divide:o}}(),toTop:{tools:{isWebkit:/webkit/gi.test(navigator.userAgent)},init:function(){var e=this,n=$("meta[name=toTop]");if(n[0]){var a=$(n.attr("content")||window),t=60,i=$("<div class='btn-to-top'></div>").appendTo(document.body);a.scrollTop()<=t&&i.fadeOut(),$(window).on("resize",$.throttle(function(){a.scrollTop()>t?i.fadeIn():i.fadeOut()})),a.on("scroll touchmove",$.throttle(function(){a.scrollTop()>t?i.fadeIn():i.fadeOut()})),i.on("click.top",function(n){n.stopPropagation();var t=a||(e.tools.isWebkit?$("body"):$("html"));t.animate({scrollTop:0},400)})}}},nav:{elements:{},config:{placeholderHeader:".placeholder-hd",autoScroll:".auto-scroll",autoFix:".auto-fix",fixTopClass:"affix affix-top"},init:function(e){var n=this,a=n.config,t=n.elements;if(a.options=e||{},t.body=$("body"),t.nav=$(a.autoScroll),t.autoFixNav=$(a.autoFix),t.placeholder_hd=$(a.placeholderHeader),t.nav[0]&&(a.navTop=t.nav.offset().top,a.navHeight=t.nav.outerHeight(!0),t.nav.on("click","ul li",function(){var e=$(this),a=t.nav.find("ul li").index(this);e.addClass("active").siblings("li").removeClass("active"),n.setNavCenter(a)})),t.autoFixNav[0]){var i=$(a.options.scrollArea)||t.body;t.placeholder_hd[0]||(t.placeholder_hd=$('<div class="placeholder-hd"></div>').prependTo(i)),t.placeholder_hd.css({height:a.navHeight,display:"none"}),i.on("scroll touchmove",function(){n.fixNav()})}},fixNav:function(){var e=this,n=e.config,a=e.elements,t=$(n.options.scrollArea)||a.body;if(a.nav[0]){var i=a.nav,o=a.placeholder_hd,s=t.scrollTop();s>n.navTop?(o.show(),i.addClass(n.fixTopClass)):(o.hide(),i.removeClass(n.fixTopClass))}},setNavCenter:function(e){function n(e){var n=0;return $.each(e,function(){n+=$(this).outerWidth(!0)}),n}var a=this,t=(a.config,a.elements),i=t.nav.find("ul li").eq(e),o=(n(t.nav.find("ul li"))-n(t.nav),n(i.prevAll())+n(i)/2-n(t.nav)/2);t.nav.find("ul").stop().animate({scrollLeft:o},200,function(){i.addClass("active").siblings().removeClass("active")})}},swipe:{elements:{},config:{tab:".ui-swipe-tab",swipe:".ui-swipe",currClass:"current"},init:function(e){var n=this,a=n.config,t=n.elements;t.swipe=$(a.swipe),t.tab=$(a.tab);var i={continuous:!1,callback:function(e,n){var t=$(n).closest(a.swipe).data("tab")||a.tab;$(t).find("ul li").eq(e).addClass("active").siblings().removeClass("active"),$(n).addClass(a.currClass).siblings().removeClass(a.currClass)}},o=$.extend({},i,e||{});t.swipe.Swipe(o).data("Swipe"),t.tab.on("click","ul li",function(){var e=$(this),n=e.index(),t=e.closest(a.tab).data("target")||a.swipe,i=$(t).data("Swipe");i.slide(n)})}},lazyLoad:{init:function(n){var a={container:$(".spa"),threshold:200,effect:"fadeIn",load:function(e,n){$(this).removeAttr("data-"+n.data_attribute)}},t=$.extend({},a,n||{});e.async("lazyload",function(){$("[data-original]").lazyload(t)})}},url:{getParams:function(e){var n={};if(e)for(var a=e.split("&"),t=0,i=a.length;t<i;t++){var o=a[t].split("="),s=a[t].match(new RegExp(o[0]+"=([^&]*)(&?)","i"));n[o[0]]=decodeURIComponent(s[1])}return n},params:function(){var e=this,n=location.search.substring(1);return e.getParams(n)},query:function(e){var n=location.search.match(new RegExp("[?&]"+e+"=([^&]*)(&?)","i"));return n?decodeURIComponent(n[1]):""}},pay:{config:{},order:function(e){location.href="/pay/?orderNo="+e},weixin:function(e){var a=this,t=e;e.config&&$.extend(e.config,a.config),console.log("M-pay-weixin----->",JSON.stringify(t.data)),n.ajax({url:"/api/wxPay",data:t.data,success:function(e){"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",function(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg&&("string"==typeof t.callback?location.href=t.callback:t.callback&&t.callback.call(this))})},!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",function(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg&&("string"==typeof t.callback?location.href=t.callback:t.callback&&t.callback.call(this))})}),document.attachEvent("onWeixinJSBridgeReady",function(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg&&("string"==typeof t.callback?location.href=t.callback:t.callback&&t.callback.call(this))})})):WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg&&("string"==typeof t.callback?location.href=t.callback:t.callback&&t.callback.call(this))})}})},alipay:function(a){var t=this,i=a;a.config&&$.extend(a.config,t.config),console.log("M-pay-alipay----->",JSON.stringify(i.data)),n.ajax({url:"/api/aliPay",data:i.data,success:function(n){var a=$(n.data);if(2==i.data.resource){var t="";a.find("input").each(function(){var e=$(this).attr("name"),n=$(this).attr("value");t+=e+"="+encodeURIComponent(n)+"&"});var o=a.attr("action")+t;e.async("3rd/ap.js",function(){_AP.pay(o)})}else a.submit()}})}},wx:{shareData:{title:"妈妈好商城",url:window.location.origin,image:"http://s.mamhao.cn/common/images/icon-114.png",desc:"好孩子集团旗下母婴电商平台，让每一件商品都是安全的！"},init:function(e,a){a||(a={}),n.ajax({data:{url:window.location.href,r:Math.random()},dataType:"jsonp",url:n.config.api+"pay/weixin/config.htm",success:function(n){console.log(n),e.config({debug:!1,appId:n.appId,timestamp:n.time,nonceStr:n.none,signature:n.sign,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice","startRecord","stopRecord","onVoiceRecordEnd","playVoice","onVoicePlayEnd","pauseVoice","stopVoice","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"]}),e.ready(function(){console.info("[wechat config is ready]"),a.ready&&a.ready.call(this)}),e.error(function(e){console.error("[wechat config error]",e.errMsg),a.error&&a.error.call(this,e)})}})},share:function(e,n){var a=this,t=$.extend({},a.shareData,n||{});e.ready(function(){var n={title:t.title,link:encodeURI(t.url),imgUrl:encodeURI(t.image),desc:t.desc,success:function(e){t.success&&t.success(e)},cancel:function(){t.cancel&&t.cancel()}},a={title:t.title,link:encodeURI(t.url),imgUrl:encodeURI(t.image),success:function(e){t.success&&t.success(e)},cancel:function(){t.cancel&&t.cancel()}};e.onMenuShareTimeline(a),e.onMenuShareAppMessage(n),e.onMenuShareQQ(n),e.onMenuShareWeibo(n)})}}};n.init(),window.alert=function(e){n.tips(e)},window.confirm=function(e,a){var t={body:""+e,buttons:[{text:"取消",class:"",onClick:null},{text:"确定",class:"success",onClick:a}]};n.dialog(t)},window.M=n}(),function(e){"use strict";e.page={defaults:{keys:{page:"page",count:"pageSize",index:"index"},scrollBox:null,flex:40,api:null,container:".pagination",current:".current",fnLoading:null,fnSuccess:null,fnFailed:null},init:function(n){var a=this,t=a.opts=e.extend(!0,{},a.defaults,n||{});e(t.container).addClass("pagination");var i=e(t.scrollBox?t.scrollBox:t.container);i.on("scroll touchmove",function(){a.scroll()}),a.run()},run:function(){var e=this,n=(e.opts,e.$ele=e.currContainer());if(!n[0]||n.data("locked"))return!1;if(!n.children()[0]){var a=n.data("params");return e.ajax(a),!1}},scroll:function(){var n=this,a=n.opts,t=n.$ele=n.currContainer();if(!t[0]||t.data("locked"))return!1;var i=a.scrollBox?e(a.scrollBox):n.currContainer(),o=i.scrollTop(),s=i[0].scrollHeight-(i.height()+o);if(s<a.flex){var c=t.data("params")||{};c[a.keys.page]=(t.data("page")||1)+1,n.ajax(c)}},currContainer:function(){var n=this,a=n.opts;return e(a.current).find(".pagination")[0]?e(a.current).find(".pagination"):e(a.container+":visible:eq(0)")},ajax:function(n){var a=this,t=a.opts;a.$ele.data("locked",!0);var i={ajax:!0};i[t.keys.page]=1,i[t.keys.count]=n.count||20,i[t.keys.index]=a.$ele.children().length;var o=e.extend(!0,i,n||{},a.opts.params||{});console.log("ajax_info--->",o),t.fnLoading?t.fnLoading.call(this,a.$ele):a.$ele.append('<div class="tc pagination-loading">正在加载中...</div>'),M.ajax({showLoading:!1,location:!0,url:o.url||t.api,data:{data:JSON.stringify(o)},success:function(e){var n={params:o,data:e};a.$ele.data("page",o[t.keys.page]),a.$ele.data("locked",!1),t.fnSuccess&&t.fnSuccess.call(this,n,a.$ele)},error:function(e){var n={params:o,data:e};if(a.$ele.data("locked",!0),t.fnFailed)t.fnFailed.call(this,n,a.$ele);else{var i=e.msg||e.statusText;M.tips(i)}},complete:function(){e(".pagination-loading").remove()}})}},e.pagination=function(n){e.page.init(n)}}(window.jQuery),function(e){e.fn.spinner=function(n){return this.each(function(){function a(){!s.text()&&s.text(o.value);var e=+s.text(),n=s.data("max"),a=s.data("min")||o.min;a&&e<=a?(c.addClass(o.disabled),e=a):c.removeClass(o.disabled),n&&e>=n?(e=n,r.addClass(o.disabled)):r.removeClass(o.disabled),s.text(e),s.siblings(o.decrement+","+o.increment).off().on("click",t)}function t(){var n=e(this),a=n.siblings(o.num);if(n.hasClass(o.disabled))return!1;var t=+a.text(),i=a.data("max"),s=a.data("min")||o.min;n.is(o.decrement)?--t:++t,s&&t<=s?(c.addClass(o.disabled),t=s):c.removeClass(o.disabled),i&&t>=i?(t=i,r.addClass(o.disabled)):r.removeClass(o.disabled),a.text(t)}var i={value:1,min:1,num:".number",decrement:".decrement",increment:".increment",disabled:"disabled"},o=e.extend({},i,n||{}),s=e(this),c=e(this).siblings(o.decrement),r=e(this).siblings(o.increment);a()})}}(window.jQuery),function(e){e.fn.timeCountDown=function(n){var a,t=e(this),i={endDate:"2088/08/08 08:08:08",startDate:!1,callback:!1,callstart:!1,callproces:!1,second:0,elements:{second:t.find(".second"),minute:t.find(".minute"),hour:t.find(".hour"),day:t.find(".day")},pms:{second:"00",minute:"00",hour:"00",day:"00"}},o=e.extend({},i,n||{});return this.each(function(){var n={zero:function(e){return e<10?"0"+e:""+e},dv:function(){var e=o.second,a=o.pms;return e>0&&(a.day=n.zero(Math.floor(e/86400)),a.hour=n.zero(Math.floor(e/3600)-24*a.day),a.minute=n.zero(Math.floor(e/60)-24*a.day*60-60*a.hour),a.second=n.zero(Math.floor(e)-24*a.day*60*60-60*a.hour*60-60*a.minute)),a},ui:function(){return e.each(o.elements,function(e,a){a[0]&&a.html(n.dv()[e]||"00")}),clearInterval(a),e.isFunction(o.callproces)&&o.callproces.call(o.callproces,o.second),o.second<=0?void(e.isFunction(o.callback)&&o.callback.call(o.callback)):(o.second--,void(a=setTimeout(n.ui,1e3)))}};if(o.second)n.ui();else{var t=new Date(o.endDate),i=o.startDate?new Date(o.startDate):new Date;o.second=Math.round((t.getTime()-i.getTime())/1e3),n.ui()}})}}(window.jQuery),function(e){var n=function(n,a){this.config={second:89,endcall:!1,startcall:!1,procescall:!1},"object"==typeof a?e.extend(this.config,a):"number"==typeof a&&(this.config.second=a),this.elems=n};n.prototype={start:function(){var n=this,a=n.config;e.isFunction(a.startcall)&&a.startcall.call(a.startcall,n),n.process(),a.obj=setInterval(function(){return a.second--,a.second<0?n.end():void n.process()},1e3)},process:function(){var n=this,a=n.config;n.elems.html(a.second),e.isFunction(a.procescall)&&a.procescall.call(a.procescall,n)},end:function(){var n=this,a=n.config;clearInterval(a.obj),e.isFunction(a.endcall)&&a.endcall.call(a.endcall,n)}},e.fn.secondCountDown=function(a){return this.each(function(){var t=new n(e(this),a);t.start()})}}(window.jQuery)});