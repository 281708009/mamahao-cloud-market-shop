define(function(require,exports,module){var t={config:{params:M.url.params(),hashParams:function(){return M.url.getParams((location.hash.match(/(\w+=)([^\&]*)/gi)||[]).join("&"))}},init:function(a){t.config;t.bindEvents()},bindEvents:function(){var a=$(".spa");a.on("click",".js-collapse",function(){var t=$(this);t.closest(".item").toggleClass("in")}),a.on("click",".js-sku",t.selectSku),a.on("click",".js-addToCart",t.addToCart),a.on("click",".mask, .js-close",function(){$(this).closest(".u-fixed").removeClass("show")}),a.on("click",".js-sku-confirm",function(){var t=$(this);require.async("app/sku",function(a){var e=a.selected();if(!e.itemId){var s=$.map($(".sku dl dt"),function(t){if(!$(t).closest("dl").find(".sku-key.active")[0])return $(t).text()})[0];return M.tips("请选择"+s)}var i=t.data("template-id"),n=$('.goods[data-template-id="'+i+'"]');n.attr("data-item-id",e.itemId).find(".spec").addClass("selected").text("已选"+e.desc.join(",")),t.closest(".u-sku").find(".js-close").trigger("click")})})},selectSku:function(){var t=$(this),a=t.closest(".item"),e=t.closest(".goods"),s=e.data("template-id");if(s===$(".js-sku-confirm").data("template-id"))return $(".u-sku").addClass("show"),!1;var i={inlet:6,reservedNo:a.data("no"),templateId:s},n=JSON.parse(localStorage.getItem(CONST.local_detail_location));n&&(i.areaId=n.areaId,i.lat=n.lat,i.lng=n.lng),M.ajax({location:!0,url:"/api/goods_sku",data:{data:JSON.stringify(i)},success:function(t){$(".u-sku").find(".content").empty().append(t.template).end().addClass("show"),require.async("app/sku",function(t){t.init($(".sku")),$(".u-quantity .number").spinner(),$(".js-sku-confirm").data("template-id",s)})}})},addToCart:function(){var t=$(this),a=t.closest(".item"),e=a.find(".goods"),s=localStorage.getItem(CONST.local_cartId);if(a.find(".goods[data-item-id]").length<e.length)return M.tips("请选择套餐的商品规格");var i=$.map(e,function(t,a){return{isBindShop:!1,templateId:$(t).data("template-id"),itemId:$(t).data("item-id"),count:+$(t).data("count")}}),n={cartId:s,jsonTerm:JSON.stringify(i),pmtType:4,reservedNo:t.closest(".item").data("no")};M.ajax({location:!0,url:"/api/addToCart",data:{data:JSON.stringify(n)},success:function(t){return 200!=t.success_code?M.tips(t.msg):(localStorage.setItem(CONST.local_cartId,t.cartId),M.tips("套餐已成功添加到购物车"),$(".u-sku .js-close").trigger("click"),void 0)}})}};module.exports=t});